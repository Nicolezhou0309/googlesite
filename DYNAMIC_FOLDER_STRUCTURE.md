# 动态文件夹结构系统

## 概述

新的动态文件夹结构系统完全移除了硬编码的文件夹名称和图片路径，改为动态读取实际的文件夹内容。这使得系统更加灵活，能够自动适应新的社区和文件夹结构。

## 主要特性

### 1. 动态文件夹结构读取
- **自动扫描**: 系统会自动扫描 `public/images/communities/` 目录下的所有社区文件夹
- **递归目录**: 支持多级嵌套的文件夹结构
- **智能过滤**: 自动跳过 `缩略图` 文件夹，只统计实际的图片内容

### 2. 中英文名称映射
- **自动翻译**: 内置了完整的中英文文件夹名称映射
- **扩展性**: 可以轻松添加新的文件夹名称映射
- **回退机制**: 如果没有找到映射，会使用原始文件夹名称

### 3. 递归图片统计
- **准确计数**: 递归统计每个文件夹及其子文件夹中的图片数量
- **多格式支持**: 支持 `.jpg`, `.jpeg`, `.png`, `.webp`, `.gif`, `.bmp`, `.svg` 等格式
- **大小写兼容**: 支持大写和小写的文件扩展名

### 4. 智能缩略图处理
- **优先缩略图**: 优先使用专门的缩略图文件夹
- **自动补充**: 如果缩略图不够，会从其他文件夹自动补充
- **数量控制**: 可以控制返回的缩略图数量

## 文件结构

```
src/
├── lib/
│   └── folderStructure.ts          # 核心动态文件夹结构读取逻辑
├── app/
│   └── api/
│       ├── folder-structure/       # 文件夹结构API端点
│       ├── full-gallery-images/    # 完整图片API端点
│       └── gallery-images/         # 缩略图API端点
└── components/
    └── CommunityGallery.tsx        # 更新后的画廊组件

scripts/
└── test-folder-structure.js        # 测试脚本
```

## API端点更新

### 1. `/api/folder-structure`
- **功能**: 返回指定社区的动态文件夹结构
- **参数**: `communityId` (必需)
- **返回**: 包含文件夹名称、显示名称、图片数量和子文件夹的嵌套结构

### 2. `/api/full-gallery-images`
- **功能**: 返回指定社区的完整图片列表
- **参数**: 
  - `communityId` (必需)
  - `page` (可选，默认0)
  - `limit` (可选，默认10)
  - `folder` (可选，指定文件夹路径)
- **返回**: 分页的图片列表，包含图片URL、尺寸、alt文本和文件夹信息

### 3. `/api/gallery-images`
- **功能**: 返回指定社区的缩略图列表
- **参数**: 
  - `communityId` (必需)
  - `limit` (可选，默认7)
- **返回**: 缩略图列表，优先使用缩略图文件夹

## 支持的社区

系统现在自动支持以下社区（基于实际文件夹结构）：

1. **jingan-center** - 静安中心社区
   - 公区 (13张图片)
   - 户型图 (34张图片)
   - 外立面 (2张图片)

2. **north-hongqiao** - 北虹桥社区
   - 公区 (5张图片)
   - 户型图 (37张图片)
   - 外立面 (3张图片)

3. **pujiang-center** - 浦江中心社区
   - 公区 (11张图片)
   - 户型图 (30张图片)
   - 外立面 (2张图片)

4. **pujiang-park** - 浦江公园社区
   - 公区 (18张图片)
   - 户型图 (31张图片)
   - 外立面 (7张图片)

5. **zhonghuan-hutai** - 中环沪太社区
   - 公区 (10张图片)
   - 户型图 (17张图片)
   - 外立面 (1张图片)

## 使用方法

### 1. 添加新社区
只需要在 `public/images/communities/` 下创建新的社区文件夹，系统会自动识别。

### 2. 添加新文件夹
在社区文件夹下创建新的子文件夹，系统会自动扫描并统计图片数量。

### 3. 添加新的中英文映射
在 `src/lib/folderStructure.ts` 的 `getDisplayName` 函数中添加新的映射：

```typescript
const nameMap = {
  '新文件夹名称': 'New Folder Name',
  // ... 其他映射
}
```

## 测试

运行测试脚本来验证系统功能：

```bash
node scripts/test-folder-structure.js
```

测试脚本会：
- 扫描所有社区文件夹
- 统计每个文件夹的图片数量
- 验证缩略图获取功能
- 显示完整的文件夹结构

## 优势

1. **无需硬编码**: 完全移除了硬编码的文件夹名称和图片路径
2. **自动适应**: 新增社区或文件夹时无需修改代码
3. **准确统计**: 实时统计实际的图片数量
4. **性能优化**: 支持分页和懒加载
5. **易于维护**: 代码结构清晰，易于扩展和维护

## 注意事项

1. **文件格式**: 确保图片文件使用支持的格式（jpg, png, webp等）
2. **文件夹命名**: 建议使用中文文件夹名称以获得更好的显示效果
3. **缩略图**: 建议为每个社区创建专门的缩略图文件夹以提高加载速度
4. **缓存**: API端点使用了适当的缓存策略以提高性能
