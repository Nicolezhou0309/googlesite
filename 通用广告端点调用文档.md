# é€šç”¨å¹¿å‘Šç«¯ç‚¹è°ƒç”¨æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†CRMç³»ç»Ÿä¸­é€šç”¨å¹¿å‘Šç«¯ç‚¹çš„è°ƒç”¨æ–¹æ³•ï¼Œè¯¥ç«¯ç‚¹ç”¨äºæ¥æ”¶æ¥è‡ªå„ç§å¹¿å‘Šå¹³å°çš„çº¿ç´¢æ•°æ®ã€‚

## ğŸŒ ç«¯ç‚¹ä¿¡æ¯

### åŸºç¡€ä¿¡æ¯
- **æœåŠ¡å™¨åœ°å€**: `8.159.132.181`
- **ç«¯å£**: `3000`
- **åè®®**: `HTTP`
- **å®Œæ•´URL**: `http://8.159.132.181:3000/api/v1/leads/ingest/generic`

### è¯·æ±‚é…ç½®
- **è¯·æ±‚æ–¹æ³•**: `POST`
- **Content-Type**: `application/json`
- **è®¤è¯**: æ— éœ€è®¤è¯ï¼ˆå·²ç§»é™¤JWTè®¤è¯ï¼‰

## ğŸ“ è¯·æ±‚æ ¼å¼

### åŸºæœ¬è¯·æ±‚ç»“æ„
```json
{
  "leads": [
    {
      "external_id": "å¤–éƒ¨ç³»ç»Ÿå”¯ä¸€ID",
      "phone": "æ‰‹æœºå·ç ",
      "wechat": "å¾®ä¿¡å·",
      "qq": "QQå·",
      "location": "ä½ç½®ä¿¡æ¯",
      "budget": "é¢„ç®—é‡‘é¢",
      "remark": "å¤‡æ³¨ä¿¡æ¯"
    }
  ],
  "platform": "æµ·å¤–ç«™"
}
```

### å®Œæ•´å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| `external_id` | string | æ˜¯ | å¤–éƒ¨ç³»ç»Ÿå”¯ä¸€æ ‡è¯† | "ad_12345" |
| `phone` | string | å¦ | æ‰‹æœºå·ç  | "13800138000" |
| `wechat` | string | å¦ | å¾®ä¿¡å· | "test_wechat" |
| `qq` | string | å¦ | QQå· | "123456789" |
| `location` | string | å¦ | ä½ç½®ä¿¡æ¯ | "åŒ—äº¬å¸‚æœé˜³åŒº" |
| `budget` | string | å¦ | é¢„ç®—é‡‘é¢ | "10000" |
| `remark` | string | å¦ | å¤‡æ³¨ä¿¡æ¯ | "é«˜æ„å‘å®¢æˆ·" |
| `douyin_id` | string | å¦ | æŠ–éŸ³ID | "douyin_123" |
| `douyin_nickname` | string | å¦ | æŠ–éŸ³æ˜µç§° | "ç”¨æˆ·æ˜µç§°" |
| `staffname` | string | å¦ | å‘˜å·¥å§“å | "å¼ ä¸‰" |
| `redbook_id` | string | å¦ | å°çº¢ä¹¦ID | "xhs_123" |
| `area` | string | å¦ | åœ°åŒº | "åä¸œåœ°åŒº" |
| `note_link` | string | å¦ | ç¬”è®°é“¾æ¥ | "https://..." |
| `campaign_id` | string | å¦ | å¹¿å‘Šç³»åˆ—ID | "camp_123" |
| `campaign_name` | string | å¦ | å¹¿å‘Šç³»åˆ—åç§° | "æ˜¥å­£æ¨å¹¿" |
| `unit_id` | string | å¦ | å¹¿å‘Šç»„ID | "unit_123" |
| `unit_name` | string | å¦ | å¹¿å‘Šç»„åç§° | "æœç´¢å¹¿å‘Šç»„" |
| `creative_id` | string | å¦ | åˆ›æ„ID | "creative_123" |
| `creative_name` | string | å¦ | åˆ›æ„åç§° | "ä¸»å›¾åˆ›æ„" |
| `lead_type` | string | å¦ | çº¿ç´¢ç±»å‹ | "è¡¨å•çº¿ç´¢" |
| `traffic_type` | string | å¦ | æµé‡ç±»å‹ | "ä»˜è´¹æµé‡" |
| `interaction_type` | string | å¦ | äº’åŠ¨ç±»å‹ | "ç‚¹å‡»" |
| `douyin_lead_id` | string | å¦ | æŠ–éŸ³çº¿ç´¢ID | "dy_lead_123" |

## ğŸ”§ è°ƒç”¨ç¤ºä¾‹

### 1. cURL ç¤ºä¾‹
```bash
curl -X POST http://8.159.132.181:3000/api/v1/leads/ingest/generic \
  -H "Content-Type: application/json" \
  -d '{
    "leads": [
      {
        "external_id": "test_123",
        "phone": "13800138000",
        "wechat": "test_wechat",
        "location": "åŒ—äº¬",
        "budget": "10000",
        "remark": "æµ‹è¯•çº¿ç´¢"
      }
    ],
    "platform": "æµ·å¤–ç«™"
  }'
```

### 2. JavaScript ç¤ºä¾‹
```javascript
const response = await fetch('http://8.159.132.181:3000/api/v1/leads/ingest/generic', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    leads: [
      {
        external_id: "test_123",
        phone: "13800138000",
        wechat: "test_wechat",
        location: "åŒ—äº¬",
        budget: "10000",
        remark: "æµ‹è¯•çº¿ç´¢"
      }
    ],
    platform: "æµ·å¤–ç«™"
  })
});

const result = await response.json();
console.log(result);
```

### 3. Python ç¤ºä¾‹
```python
import requests
import json

url = "http://8.159.132.181:3000/api/v1/leads/ingest/generic"
headers = {"Content-Type": "application/json"}

data = {
    "leads": [
        {
            "external_id": "test_123",
            "phone": "13800138000",
            "wechat": "test_wechat",
            "location": "åŒ—äº¬",
            "budget": "10000",
            "remark": "æµ‹è¯•çº¿ç´¢"
        }
    ],
    "platform": "æµ·å¤–ç«™"
}

response = requests.post(url, headers=headers, data=json.dumps(data))
result = response.json()
print(result)
```

## ğŸ“Š å“åº”æ ¼å¼

### æˆåŠŸå“åº”
```json
{
  "code": "200",
  "message": "success"
}
```

### é”™è¯¯å“åº”
```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°",
  "code": "é”™è¯¯ä»£ç ",
  "timestamp": "2025-09-24T15:53:31.995Z"
}
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. å¹³å°åç§°é™åˆ¶
- **å¿…é¡»ä½¿ç”¨**: `"æµ·å¤–ç«™"` ä½œä¸º platform å€¼
- **åŸå› **: æ•°æ®åº“ä¸­çš„ source å­—æ®µæœ‰æšä¸¾é™åˆ¶
- **å…¶ä»–å€¼**: ä¼šå¯¼è‡´æ•°æ®åº“é”™è¯¯

### 2. æ•°æ®éªŒè¯
- `external_id` å­—æ®µæ˜¯å¿…å¡«çš„ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†çº¿ç´¢
- ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ `leadid` æ ¼å¼ï¼š`{platform}_{external_id}_{timestamp}`
- ç©ºå€¼å’Œæ— æ•ˆå€¼ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤

### 3. æ•°æ®æ˜ å°„
ç³»ç»Ÿä¼šè‡ªåŠ¨å°†å¤–éƒ¨æ•°æ®æ˜ å°„åˆ°å†…éƒ¨æ•°æ®åº“å­—æ®µï¼š
- `external_id` â†’ ç”¨äºç”Ÿæˆ `leadid`
- `platform` â†’ æ˜ å°„åˆ° `source` å­—æ®µ
- å…¶ä»–å­—æ®µç›´æ¥æ˜ å°„åˆ°å¯¹åº”æ•°æ®åº“åˆ—

## ğŸ” å¥åº·æ£€æŸ¥

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
curl http://8.159.132.181:3000/api/v1/health
```

### å“åº”ç¤ºä¾‹
```json
{
  "success": true,
  "status": "healthy",
  "timestamp": "2025-09-24T15:53:22.597Z",
  "version": "1.0.0",
  "services": {
    "database": "connected"
  }
}
```

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

### æœåŠ¡å™¨ä¿¡æ¯
- **IPåœ°å€**: 8.159.132.181
- **ç”¨æˆ·å**: root
- **æœåŠ¡ç›®å½•**: /opt/ads-lead-api
- **è¿›ç¨‹ç®¡ç†**: PM2

### å¸¸ç”¨ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# é‡å¯æœåŠ¡
pm2 restart ads-lead-api

# æŸ¥çœ‹æ—¥å¿—
pm2 logs ads-lead-api

# åœæ­¢æœåŠ¡
pm2 stop ads-lead-api

# å¯åŠ¨æœåŠ¡
pm2 start ads-lead-api
```

## ğŸ“ˆ æ€§èƒ½ç‰¹æ€§

- **å¹¶å‘å¤„ç†**: æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘å¤„ç†
- **æ‰¹é‡æ’å…¥**: æ”¯æŒæ‰¹é‡æ’å…¥å¤šæ¡çº¿ç´¢æ•°æ®
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **æ•°æ®éªŒè¯**: è‡ªåŠ¨æ•°æ®éªŒè¯å’Œæ¸…ç†
- **æ€§èƒ½ç›‘æ§**: å†…ç½®æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦

## ğŸ”’ å®‰å…¨è¯´æ˜

- **æ— è®¤è¯**: å½“å‰ç‰ˆæœ¬å·²ç§»é™¤JWTè®¤è¯
- **æ•°æ®è„±æ•**: æ ¹æ®é…ç½®è¿›è¡Œæ•°æ®è„±æ•å¤„ç†
- **æ—¥å¿—è®°å½•**: æ‰€æœ‰æ“ä½œéƒ½æœ‰è¯¦ç»†æ—¥å¿—è®°å½•
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
2. æœåŠ¡æ˜¯å¦è¿è¡Œæ­£å¸¸
3. è¯·æ±‚æ ¼å¼æ˜¯å¦æ­£ç¡®
4. platform å€¼æ˜¯å¦ä¸º "æµ·å¤–ç«™"

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-09-24  
**ç»´æŠ¤è€…**: CRMå¼€å‘å›¢é˜Ÿ
